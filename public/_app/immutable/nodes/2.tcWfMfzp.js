import{f as p,a as v,t as ee,c as te}from"../chunks/D1lnn1AM.js";import{i as le}from"../chunks/DQ63pgYu.js";import{h as J,B as d,C as _,D as i,z as I,x as oe,y as E,A as ie,q as e,aC as T,R as y,U as g,aG as Se,aH as xe,aI as Ae,j as fe}from"../chunks/CLULA6Dc.js";import{o as ve}from"../chunks/DoGVUbLG.js";import{s as M,d as we}from"../chunks/B0lS5IyR.js";import{i as B,p as Te,b as Pe}from"../chunks/BYc1LNDs.js";import{s as ke}from"../chunks/WSJjU_7O.js";function de(a){var n,t,r="";if(typeof a=="string"||typeof a=="number")r+=a;else if(typeof a=="object")if(Array.isArray(a)){var o=a.length;for(n=0;n<o;n++)a[n]&&(t=de(a[n]))&&(r&&(r+=" "),r+=t)}else for(t in a)a[t]&&(r&&(r+=" "),r+=t);return r}function Ce(){for(var a,n,t=0,r="",o=arguments.length;t<o;t++)(a=arguments[t])&&(n=de(a))&&(r&&(r+=" "),r+=n);return r}function Ie(a){return typeof a=="object"?Ce(a):a??""}function Me(a,n,t){var r=a==null?"":""+a;return n&&(r=r?r+" "+n:n),r===""?null:r}function Re(a,n){return a==null?null:String(a)}function ce(a,n,t,r,o,c){var b=a.__className;if(J||b!==t||b===void 0){var P=Me(t,r);(!J||P!==a.getAttribute("class"))&&(P==null?a.removeAttribute("class"):a.className=P),a.__className=t}return c}function je(a,n,t,r){var o=a.__style;if(J||o!==n){var c=Re(n);(!J||c!==a.getAttribute("style"))&&(c==null?a.removeAttribute("style"):a.style.cssText=c),a.__style=n}return r}var Ee=p('<div class="card svelte-1udyrqm"><!></div>');function V(a,n){var t=Ee(),r=d(t);ke(r,()=>n.children),_(t),v(a,t)}var Oe=p('<div class="metric svelte-1ttwpcc"><span class="label svelte-1ttwpcc"> </span> <span class="value svelte-1ttwpcc"> </span></div>');function q(a,n){var t=Oe(),r=d(t),o=d(r,!0);_(r);var c=i(r,2),b=d(c,!0);_(c),_(t),I(()=>{M(o,n.label),M(b,n.value)}),v(a,t)}var Le=p('<div class="progress svelte-1qjgclg"><div class="progress-inner svelte-1qjgclg"></div></div>');function Y(a,n){var t=Le();I(()=>je(t,`--percent: ${n.percent}%`)),v(a,t)}var Ne=p("<span> </span>");function re(a,n){var t=Ne(),r=d(t,!0);_(t),I(()=>{ce(t,1,`badge ${n.variant}`,"svelte-12nqn7t"),M(r,n.label)}),v(a,t)}const Be="admin",Ue="ajax-rubs-shut-warms",qe=btoa(`${Be}:${Ue}`),_e={Authorization:`Basic ${qe}`,"Content-Type":"application/json"};async function Q(a){const n=await fetch(a,{method:"GET",headers:_e,credentials:"include"});return n.ok||(console.log(`System API error ${n.status}: ${n.statusText}`),alert("Error!")),await n.json()}async function ue(a){const n=await fetch(a,{method:"POST",headers:_e,credentials:"include"});return n.ok||(console.log(`System API error ${n.status}: ${n.statusText}`),alert("Error!")),await n.json()}const He="https://dashboard.sonnel.eu",pe=`${He}/api/system`;async function Fe(){return await Q(`${pe}/cpu`)}async function De(){return await Q(`${pe}/memory`)}var Ge=p('<div class="text-muted"> </div>'),Ve=p('<h2 class="section-subtitle">CPU <!></h2> <!> <!> <!>',1),ze=p('<h2>Memory</h2> <!> <!> <!> <!> <div class="text-muted"><!></div>',1),Ke=p('<div class="section-title">System</div> <!> <div class="grid"><!> <!></div>',1);function We(a,n){oe(n,!1);let t=T(null),r=T(null),o=T(null);function c(f){return f==="normal"?"ok":f==="warning"?"warn":f==="critical"?"crit":"offline"}async function b(){try{g(o,null);const[f,A]=await Promise.all([Fe(),De()]);g(t,f),g(r,A)}catch(f){g(o,f.message)}finally{}}ve(()=>{b();const f=setInterval(b,5e3);return()=>clearInterval(f)}),le();var P=Ke(),G=i(E(P),2);{var R=f=>{var A=Ge(),m=d(A);_(A),I(()=>M(m,`Failed to load system info: ${e(o)??""}`)),v(f,A)};B(G,f=>{e(o)&&f(R)})}var j=i(G,2),O=d(j);V(O,{children:(f,A)=>{var m=Ve(),S=E(m),L=i(d(S));{var N=l=>{{let w=y(()=>c(e(t).temperatureStatus));re(l,{get label(){return e(t).temperatureStatus},get variant(){return e(w)}})}},U=l=>{re(l,{label:"…",variant:"offline"})};B(L,l=>{e(t)?l(N):l(U,!1)})}_(S);var s=i(S,2);{let l=y(()=>e(t)?`${e(t).temperature} °C`:"–");q(s,{label:"Temperature",get value(){return e(l)}})}var u=i(s,2);{let l=y(()=>e(t)?`${e(t).usage.toFixed(1)} %`:"–");q(u,{label:"Usage",get value(){return e(l)}})}var $=i(u,2);{let l=y(()=>e(t)?e(t).usage:0);Y($,{get percent(){return e(l)}})}v(f,m)}});var H=i(O,2);V(H,{children:(f,A)=>{var m=ze(),S=i(E(m),2);{let l=y(()=>e(r)?`${e(r).ram.used_gb} / ${e(r).ram.total_gb} (${e(r).ram.percent.toFixed(1)}%)`:"–");q(S,{label:"RAM used",get value(){return e(l)}})}var L=i(S,2);{let l=y(()=>e(r)?e(r).ram.percent:0);Y(L,{get percent(){return e(l)}})}var N=i(L,2);{let l=y(()=>e(r)?`${e(r).disk.used_gb} / ${e(r).disk.total_gb} (${e(r).disk.percent.toFixed(1)}%)`:"–");q(N,{label:"Disk used",get value(){return e(l)}})}var U=i(N,2);{let l=y(()=>e(r)?e(r).disk.percent:0);Y(U,{get percent(){return e(l)}})}var s=i(U,2),u=d(s);{var $=l=>{var w=ee();I(()=>M(w,`Disk free: ${e(r).disk.free_gb??""} GB`)),v(l,w)};B(u,l=>{e(r)&&l($)})}_(s),v(f,m)}}),_(j),v(a,P),ie()}var Je=p('<span class="pill svelte-13sxkx7"><span></span> <span> </span></span>');function Qe(a,n){var t=Je(),r=d(t),o=i(r,2),c=d(o,!0);_(o),_(t),I(()=>{ce(r,1,`pill-dot ${n.status}`,"svelte-13sxkx7"),M(c,n.value)}),v(a,t)}var Xe=p("<button> </button>");function Z(a,n){let t=Te(n,"disabled",3,!1);var r=Xe();r.__click=function(...c){n.onClick?.apply(this,c)};var o=d(r,!0);_(r),I(()=>{ce(r,1,Ie(n.variant),"svelte-18sv61c"),r.disabled=t(),M(o,n.label)}),v(a,r)}we(["click"]);const ae="start",ne="restart",se="stop",Ye="https://dashboard.sonnel.eu",z=`${Ye}/api/minecraft`;async function Ze(){return await Q(`${z}/activity`)}async function et(a=200){const n=`${z}/logs?lines=${encodeURIComponent(a)}`;return await Q(n)}function tt(){return ue(`${z}/${ae}`)}function rt(){return ue(`${z}/${ne}`)}function at(){return ue(`${z}/${se}`)}var nt=p('<div class="text-muted"> </div>'),st=p('<h2 class="section-subtitle">Status <!></h2> <!> <!> <!> <!>',1),lt=p('<h2 class="section-subtitle">Actions <!></h2> <div class="actions svelte-jnq8ai"><div class="action-buttons svelte-jnq8ai"><!> <!> <!></div></div> <div class="text-muted"><!></div>',1),ot=p('<div class="section-title">Minecraft</div> <!> <div class="grid"><!> <!></div>',1);function it(a,n){oe(n,!1);let t=T(null),r=T(!0),o=T(null),c=T(null),b=T(null);function P(s){return s?s.online?"Online":"Offline":"Unknown"}function G(s){return s&&s.online?"online":"offline"}function R(s){return!s||s==="offline"?"offline":s==="chill"?"ok":s==="normal"?"warn":"crit"}function j(s){if(!s||!s.players)return"–";const{online:u,max:$,sample_names:l}=s.players,w=l&&l.length>0?` [${l.join(", ")}]`:"";return`${u}/${$}${w}`}function O(s){return!s||s.latency_ms==null?"–":`${s.latency_ms.toFixed(1)} ms`}async function H(){try{g(o,null);const s=await Ze();g(t,s)}catch(s){g(o,s.message)}finally{g(r,!1)}}async function f(s){g(b,s),g(c,`Calling ${s}...`);let u=null;try{s===ae?u=await tt():s===ne?u=await rt():s===se?u=await at():console.log("Wrong action!"),u?.ok?g(c,`Action '${s}' sent successfully.`):g(c,`Action '${s}' failed: ${u?.stderr||"unknown error"}`)}catch($){g(c,`Action '${s}' failed: ${$.message}`)}finally{g(b,null),setTimeout(H,1500)}}ve(()=>{H();const s=setInterval(H,5e3);return()=>clearInterval(s)}),le();var A=ot(),m=i(E(A),2);{var S=s=>{var u=nt(),$=d(u);_(u),I(()=>M($,`Failed to load Minecraft info: ${e(o)??""}`)),v(s,u)};B(m,s=>{e(o)&&s(S)})}var L=i(m,2),N=d(L);V(N,{children:(s,u)=>{var $=st(),l=E($),w=i(d(l));{let C=y(()=>G(e(t))),W=y(()=>P(e(t)));Qe(w,{get status(){return e(C)},get value(){return e(W)}})}_(l);var x=i(l,2);{let C=y(()=>e(t)?e(t).process.state:"–");q(x,{label:"Process",get value(){return e(C)}})}var k=i(x,2);{let C=y(()=>j(e(t)));q(k,{label:"Players",get value(){return e(C)}})}var F=i(k,2);{let C=y(()=>e(t)?e(t).version??"–":"–");q(F,{label:"Version",get value(){return e(C)}})}var K=i(F,2);{let C=y(()=>O(e(t)));q(K,{label:"Latency",get value(){return e(C)}})}v(s,$)}});var U=i(N,2);V(U,{children:(s,u)=>{var $=lt(),l=E($),w=i(d(l));{let h=y(()=>e(t)?e(t).mood:"…"),D=y(()=>R(e(t)?e(t).mood:null));re(w,{get label(){return e(h)},get variant(){return e(D)}})}_(l);var x=i(l,2),k=d(x),F=d(k);{let h=y(()=>!!e(b));Z(F,{label:"Start",variant:"primary",get disabled(){return e(h)},onClick:()=>f(ae)})}var K=i(F,2);{let h=y(()=>!!e(b));Z(K,{label:"Restart",variant:"neutral",get disabled(){return e(h)},onClick:()=>f(ne)})}var C=i(K,2);{let h=y(()=>!!e(b));Z(C,{label:"Stop",variant:"danger",get disabled(){return e(h)},onClick:()=>f(se)})}_(k),_(x);var W=i(x,2),ge=d(W);{var me=h=>{var D=ee();I(()=>M(D,e(c))),v(h,D)},$e=h=>{var D=te(),ye=E(D);{var be=X=>{var he=ee("Loading Minecraft status...");v(X,he)};B(ye,X=>{e(r)&&X(be)},!0)}v(h,D)};B(ge,h=>{e(c)?h(me):h($e,!1)})}_(W),v(s,$)}}),_(L),v(a,A),ie()}var vt=p("<pre>Loading logs...</pre>"),ct=p('<pre style="color: #ef4444"> </pre>'),ut=p("<pre> </pre>"),ft=p("<pre>No logs available.</pre>"),dt=p('<div class="minecraft-logs svelte-t76a2a"><!></div>'),_t=p('<div class="section-title">Minecraft logs</div> <!>',1);function pt(a,n){oe(n,!1);let t=T(null),r=T(null),o=T(null),c=T(!0);async function b({asPoll:R=!1}={}){try{g(r,null),R||g(c,!0);const j=await et();e(t)?.lines!==j.lines&&g(t,j)}catch(j){g(r,j.message)}finally{g(c,!1)}}ve(()=>{b({asPoll:!1});const R=setInterval(()=>b({asPoll:!0}),5e3);return()=>clearInterval(R)}),Se(()=>(e(o),e(t)),()=>{e(o)&&e(t)?.lines&&e(o).scrollHeight-e(o).scrollTop-e(o).clientHeight<40&&Ae(o,e(o).scrollTop=e(o).scrollHeight)}),xe(),le();var P=_t(),G=i(E(P),2);V(G,{children:(R,j)=>{var O=dt(),H=d(O);{var f=m=>{var S=vt();v(m,S)},A=m=>{var S=te(),L=E(S);{var N=s=>{var u=ct(),$=d(u);_(u),I(()=>M($,`Error: ${e(r)??""}`)),v(s,u)},U=s=>{var u=te(),$=E(u);{var l=x=>{var k=ut(),F=d(k,!0);_(k),I(()=>M(F,(e(t),fe(()=>e(t).lines)))),v(x,k)},w=x=>{var k=ft();v(x,k)};B($,x=>{e(t),fe(()=>e(t)&&e(t).ok)?x(l):x(w,!1)},!0)}v(s,u)};B(L,s=>{e(r)?s(N):s(U,!1)},!0)}v(m,S)};B(H,m=>{e(c)?m(f):m(A,!1)})}_(O),Pe(O,m=>g(o,m),()=>e(o)),v(R,O)}}),v(a,P),ie()}var gt=p('<div class="container"><h1>HomePi Dashboard</h1> <div class="subtitle">System & Minecraft overview – refreshed every 5 seconds.</div> <!> <!> <!></div>');function At(a){var n=gt(),t=i(d(n),4);We(t,{});var r=i(t,2);it(r,{});var o=i(r,2);pt(o,{}),_(n),v(a,n)}export{At as component};
